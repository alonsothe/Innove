<!DOCTYPE html>
<html lang="es" data-scheme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f1e" id="metaThemeColor"/>
  <title>Innove Planner — Oscuro legible + súper responsive</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{box-sizing:border-box} html,body{height:100%}
    :root{
      --bg:#0b0f1e; --text:#f4f8ff; --muted:#a8b6d6; --border:#22305e;
      --panel:rgba(16,22,44,.94); --panel-strong:rgba(19,25,50,.96); /* Más translúcido para ver el fondo */
      --accent:#60a5fa; --accent2:#a78bfa; --ring:0 0 0 8px rgba(125,211,252,.14);
      --r:16px; --r2:20px; --shadow:0 16px 48px rgba(2,6,23,.65), inset 0 1px 0 rgba(255,255,255,.05);
      --maxw:1280px; --ease:cubic-bezier(.2,.8,.2,1);
      /* tokens chip base (cambian con media queries) */
      --chip-fs:14px; --chip-pad:6px 10px; --chip-dot:12px;

      /* Gradientes de fondo personalizables (futuristas) */
      --bg-top:#0b1020;
      --bg-middle:#0e1430;
      --bg-bottom:#0a0f24;

      /* Ajuste global de radios: ligeramente menos redondeados para un look profesional */
      /* Reducimos los radios globales un poco más para un look menos redondeado */
      --r:10px;
      --r2:16px;

    /* Configuración global para la animación del starfield. Estas variables permiten ajustar fácilmente la
       densidad y velocidad de las estrellas sin tocar el código JS. El número de estrellas determina cuántos
       puntos se dibujan y la velocidad define su desplazamiento vertical. */
    --star-count: 100;
    --star-speed: 0.05;
    }
    html[data-scheme='light']{
      --bg:#f4f7ff; --text:#0a1022; --muted:#475569; --border:rgba(2,6,23,.18);
      --panel:#ffffff; --panel-strong:#fff;

      /* Gradientes claros para modo claro */
      --bg-top:#f4f7ff;
      --bg-middle:#e9f2ff;
      --bg-bottom:#f1f6ff;
    }

    body{margin:0; font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial; color:var(--text); background:var(--bg); line-height:1.55; overflow-x:hidden;}
    .bg, .glow, .grid { position: fixed; inset: 0; pointer-events:none; z-index:-3; }
    .bg{
      /* Fondo dinámico que mezcla los acentos con transparencias y un gradiente vertical personalizado */
      background:
        /* Aumentamos la mezcla de colores para que los acentos se noten más en todas las variantes */
        radial-gradient(1300px 780px at 72% -10%, color-mix(in oklab, var(--accent) 60%, transparent) 0%, transparent 60%),
        radial-gradient(1100px 660px at 12% 120%, color-mix(in oklab, var(--accent2) 60%, transparent) 0%, transparent 60%),
        linear-gradient(180deg, var(--bg-top), var(--bg-middle) 45%, var(--bg-bottom));
      opacity:.95; will-change:transform;
    }
    .glow{ filter:blur(80px) saturate(140%); opacity:.32;
      /* Cono de brillo dinámico basado en los acentos, que gira lentamente */
      background: conic-gradient(from 200deg,
        color-mix(in oklab, var(--accent) 50%, transparent),
        color-mix(in oklab, var(--accent2) 50%, transparent),
        color-mix(in oklab, var(--accent) 50%, transparent)
      );
      animation: spin 36s linear infinite;
    }
    .grid{ opacity:.12; mask-image: radial-gradient(70% 60% at 50% 35%, #000 60%, transparent 100%);
      background:
        linear-gradient(transparent 0 98%, color-mix(in oklab, var(--accent2) 35%, transparent) 98%) 0 0/ 100% 40px,
        linear-gradient(90deg, transparent 0 98%, color-mix(in oklab, var(--accent) 35%, transparent) 98%) 0 0/ 40px 100%;
      transform: perspective(1000px) rotateX(58deg) translateY(-32%);
      animation: pan 28s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes pan{to{background-position:0 40px, 40px 0}}
    @keyframes rise{from{opacity:0; transform:translateY(10px) scale(.98)} to{opacity:1; transform:translateY(0) scale(1)}}
    @keyframes pop{from{transform:scale(.96); opacity:.8} to{transform:scale(1); opacity:1}}
    @keyframes shimmer{from{background-position:-200% 0} to{background-position:200% 0}}
    @keyframes floaty{0%,100%{transform:translateY(0)} 50%{transform:translateY(-4px)}}

    .container{max-width:var(--maxw); margin:0 auto; padding:16px}
    .panel{background:var(--panel); border:1px solid var(--border); border-radius:var(--r2); box-shadow:var(--shadow); backdrop-filter:blur(14px) saturate(170%)}
    .nav{position:sticky; top:12px; z-index:60; display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 16px; animation:rise .4s var(--ease) both}
    .brand{display:flex; align-items:center; gap:12px; font-weight:800}
    .logo{width:40px; height:40px; border-radius:50%; display:grid; place-items:center; position:relative; transform-style:preserve-3d; transition:transform .35s var(--ease)}
    .logo:hover{transform:rotateX(12deg) rotateY(-8deg)}
    .logo::before{content:""; position:absolute; inset:-2px; border-radius:inherit; padding:2px; background:conic-gradient(from 140deg, var(--accent), var(--accent2), var(--accent)); -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; filter: drop-shadow(0 0 10px rgba(125,211,252,.5));}
    .logo .core{width:74%; height:74%; border-radius:inherit; background:radial-gradient(circle at 40% 40%, #fff 10%, var(--accent) 26%, var(--accent2) 60%, transparent 72%);}
    .brand-name{background: linear-gradient(90deg, var(--accent), var(--accent2)); -webkit-background-clip:text; background-clip:text; color:transparent; background-size:200% 100%; animation: shimmer 6s linear infinite}

    .nav-right{display:flex; align-items:center; gap:10px; flex-wrap:wrap}

    /* Atajos rápidos dentro de la barra de navegación.
       Los iconos se presentan como burbujas circulares con un degradado acorde al tema,
       permitiendo acceder rápidamente a Gmail, Chats, Juegos y al editor de fotos. */
    .quick-apps{display:flex; align-items:center; gap:12px; margin-left:6px;}
    .quick-apps a{
      display:flex;
      align-items:center;
      justify-content:center;
      width:36px;
      height:36px;
      border-radius:50%;
      border:1px solid var(--border);
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#0b1020;
      font-size:20px;
      font-weight:900;
      box-shadow:var(--shadow);
      text-decoration:none;
      transition:transform .18s var(--ease), box-shadow .18s var(--ease);
    }
    .quick-apps a:hover{
      transform:translateY(-2px) scale(1.07);
      box-shadow:var(--ring);
    }

    /* Perfil editable dentro de la barra de navegación. */
    .profile{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--panel-strong);
      cursor:pointer;
      user-select:none;
      font-weight:700;
      transition:transform .18s var(--ease), box-shadow .2s ease;
    }
    .profile:hover{ transform:translateY(-1px); box-shadow:var(--ring); }
    .profile span:first-child{ font-size:20px; }
    .level-badge{
      font-size:11px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#0b1020;
      padding:2px 6px;
      border-radius:8px;
      margin-left:6px;
      font-weight:800;
      min-width:28px;
      text-align:center;
    }

    /* Modal overlay para editar el perfil */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.45);
      z-index:200;
    }
    .modal.show{ display:flex; }
    .modal-content{
      width:min(420px, 90vw);
      border-radius:28px;
      padding:28px;
      display:flex;
      flex-direction:column;
      gap:18px;
      box-shadow:0 30px 70px rgba(0,0,0,.35);
      /* Fondo y colores del modal inspirados en la maqueta: claro incluso en oscuro */
      background:#f8fafc;
      color:#0a1022;
      border:1px solid #e2e8f0;
    }
    /* Ajustamos el modal para modo claro: mantiene un blanco neutro */
    html[data-scheme='light'] .modal-content{
      background:#ffffff;
      color:#0a1022;
      border:1px solid #e2e8f0;
    }
    /* Encabezado del modal: más grande y en negrita */
    .modal-content h3{
      margin:0;
      margin-bottom:10px;
      font-size:28px;
      font-weight:800;
      color:#0a1022;
    }
    /* Etiquetas del formulario: legibles y con peso medio */
    .modal-content label{
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:15px;
      font-weight:600;
      color:#475569;
    }
    .modal-content input,
    .modal-content select{
      padding:14px 16px;
      border-radius:14px;
      border:1px solid #dbe0eb;
      background:#ffffff;
      color:#0a1022;
      font-size:15px;
    }

    /* Cuando el selector (p.ej. emoji) está deshabilitado, eliminamos la flecha del desplegable
       y desactivamos el puntero para evitar que parezca editable. */
    .modal-content select:disabled{
      pointer-events:none;
      appearance:none;
      -moz-appearance:none;
      -webkit-appearance:none;
    }
    .modal-content input::placeholder{ color:#94a3b8; }
    /* Barra de nivel y valor al lado */
    .modal-content input[type="range"]{ accent-color: var(--accent); }
    .modal-content .buttons{
      display:flex;
      justify-content:flex-end;
      gap:12px;
      margin-top:16px;
    }
    .modal-content .buttons .btn{
      flex:1;
      justify-content:center;
      padding:12px 18px;
      font-size:15px;
      border-radius:14px;
      border:none;
    }
    /* Botón cancelar: estilo secundario gris azulado */
    .modal-content .buttons .btn{
      background:#e4eaf5;
      color:#0a1022;
    }
    /* Botón guardar: degradado con los acentos principales */
    .modal-content .buttons .btn-cta{
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#0b1020;
    }
    .btn{position:relative; overflow:hidden; padding:10px 14px; border-radius:999px; border:1px solid var(--border); background:var(--panel-strong); color:var(--text); font-weight:800; cursor:pointer; display:inline-flex; align-items:center; gap:8px; transition:transform .16s var(--ease), box-shadow .2s ease, filter .2s ease}
    .btn:hover{transform:translateY(-1px); box-shadow:var(--ring)}
    .btn-cta{background:linear-gradient(90deg,var(--accent),var(--accent2)); border-color:transparent; color:#0b1020}

    /* SEARCH legible en oscuro */
    .search{display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid color-mix(in oklab, var(--border) 70%, #000 30%); background:rgba(255,255,255,.06)}
    html[data-scheme='light'] .search{background:var(--panel-strong); border-color:var(--border)}
    .search input{border:0; outline:none; background:transparent; color:var(--text); font-size:14px; width:min(260px,35vw)}
    @media (max-width:640px){ .search input{width:38vw} }
    .search input::placeholder{color:color-mix(in oklab, var(--text) 30%, transparent)}
    .search:focus-within{box-shadow:var(--ring); border-color:color-mix(in oklab, var(--accent) 40%, transparent)}

    /* Switch modo ☀️/🌙 */
    .mode-switch{display:inline-flex; border:1px solid var(--border); border-radius:999px; padding:4px; background:var(--panel-strong); overflow:hidden}
    .mode-switch button{
      border:0;
      /* Añadimos un fondo translúcido y difuminado para mejorar la visibilidad en modo oscuro */
      background:rgba(255,255,255,.08);
      backdrop-filter:blur(6px) saturate(160%);
      padding:6px 8px;
      width:40px;
      height:40px;
      display:grid;
      place-items:center;
      border-radius:14px;
      font-size:22px;
      cursor:pointer;
      color:var(--text);
      position:relative;
      overflow:hidden;
      transition:background .3s var(--ease), transform .3s var(--ease), box-shadow .3s var(--ease);
    }
    /* Estado activo del botón de modo: degradado con acentos y un halo */
    .mode-switch button.active{
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#0b1020;
      box-shadow:0 0 0 2px color-mix(in oklab,var(--accent) 50%, transparent) inset, 0 4px 12px rgba(2,6,23,.3);
    }
    /* Crea un halo rotatorio alrededor de los botones de modo para un efecto futurista */
    .mode-switch button::after{
      content:"";
      position:absolute;
      inset:-4px;
      border-radius:inherit;
      border:2px solid color-mix(in oklab, var(--accent) 50%, transparent);
      opacity:.5;
      animation: rotateRing 14s linear infinite;
      pointer-events:none;
    }
    @keyframes rotateRing{to{transform:rotate(360deg)}}

    /* Tema dock ajustado: más compacto, chips más grandes y sin barra decorativa */
    .theme-dock{
      position:fixed;
      left:50%;
      bottom:calc(8px + env(safe-area-inset-bottom,0px));
      transform:translate(-50%, 0);
      z-index:70;
      width:fit-content;
      max-width:calc(100vw - 32px);
      padding:0;
      /* Aplicamos un fondo translúcido y blur sutil para que las pastillas floten mejor sobre el contenido */
      backdrop-filter: blur(16px) saturate(160%);
      background: rgba(0,0,0,.15);
      /* Redondeamos el contenedor para un aspecto de pastilla circular */
      border-radius:999px;
      border:1px solid var(--border);
      /* Variables de tamaño de chips en el dock */
      /* Para la versión final, reducimos ligeramente el tamaño y acolchado para que el dock ocupe menos vertical */
      --chip-fs:13px;
      --chip-pad:6px 12px;
      --chip-dot:12px;
    }
    /* Ajuste de fondo del dock en modo claro: color traslúcido claro */
    html[data-scheme="light"] .theme-dock{
      background: rgba(255,255,255,.55);
    }
    .theme-bar{
      /* Eliminamos cualquier aspecto de barra para que las pastillas se vean sueltas */
      display:flex;
      align-items:center;
      gap:6px;
      padding:2px 4px;
      background:none;
      border:none;
      /* El dock interno adopta una forma circular */
      border-radius:999px;
      box-shadow:none;
      backdrop-filter:none;
    }
    /* Eliminar fondo en modo oscuro para la barra */
    html[data-scheme="dark"] .theme-bar{ background:transparent; }
    .themes{
      display:flex;
      gap:4px;
      overflow-x:auto;
      overflow-y:hidden;
      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling:touch;
      /* Ocultar barra de desplazamiento para una experiencia limpia */
      scrollbar-width:none;
    }

    .themes::-webkit-scrollbar{ display:none; }
    .pill{position:relative; display:inline-flex; align-items:center; gap:6px; padding:var(--chip-pad); border:1px solid color-mix(in oklab, var(--border) 70%, #fff 8%); background:rgba(255,255,255,.07);
      border-radius:999px; font-weight:800; white-space:nowrap; cursor:pointer; transition:transform .14s ease, box-shadow .18s ease; font-size:var(--chip-fs); color:var(--text); scroll-snap-align:center;
      /* Ajustamos el grosor y opacidad del fondo de las pastillas para una mejor lectura en oscuro */
      backdrop-filter:blur(6px) saturate(130%);
      background:rgba(255,255,255,.08);
    }
    /* Pastillas: colores sutiles según el modo. Menos brillo en oscuro para evitar deslumbrar. */
    html[data-scheme="light"] .pill{ background:#f6f8fe; border:1px solid #e2e8f0; color:#0a1022; }
    html[data-scheme="dark"] .pill{ background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.14); color:var(--text); }
    .pill:hover{transform:translateY(-1px); box-shadow:0 8px 22px rgba(2,6,23,.28)}
    .pill.active{box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 60%, transparent) inset}
    .pill.active::after{content:""; position:absolute; inset:-5px; border-radius:inherit; background: radial-gradient(closest-side, rgba(125,211,252,.28), transparent 60%); filter: blur(4px);}
    .dot{width:var(--chip-dot); height:var(--chip-dot); border-radius:50%; border:1px solid color-mix(in oklab, var(--border) 80%, #fff 10%)}
    /* El botón de cierre para los temas: aún más compacto y con forma circular */
    .pill-close{
      padding:4px;
      width:28px;
      height:28px;
      font-size:14px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .fab{position:fixed; right:12px; bottom:calc(12px + env(safe-area-inset-bottom,0px)); z-index:69; padding:8px 10px; border-radius:999px; border:1px solid var(--border); background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#0b1020; font-weight:900; display:flex; align-items:center; gap:6px; box-shadow:var(--shadow); cursor:pointer; transition:transform .18s var(--ease)}
    .fab:hover{transform:translateY(-1px) scale(1.04)}

    /* Estado activo del botón de paleta cuando la barra de temas está visible */
    #openDock.active{
      transform: translateY(-2px) scale(1.1);
      box-shadow: var(--ring);
    }

    /* Breakpoints de compacidad del dock */
    @media (max-width:820px){
      :root{ --chip-fs:13px; --chip-pad:5px 9px; --chip-dot:11px; }
      /* Ajuste de la barra de temas para móviles: se conserva fit-content y la barra puede desplazarse */
    }
    @media (max-width:540px){
      :root{ --chip-fs:12px; --chip-pad:4px 8px; --chip-dot:10px; }
      .theme-bar{ padding:5px }
    }
    @media (max-width:400px){
      :root{ --chip-fs:11px; --chip-pad:4px 6px; --chip-dot:9px; }
      .pill span.label{ display:none } /* esconder texto y dejar solo los puntos + halo si ya no entra */
    }

    /* Layout principal */
    .layout{display:grid; grid-template-columns:280px 1fr; gap:16px; margin-top:12px}
    @media (max-width:980px){ .layout{grid-template-columns:1fr} }
    .dock{position:sticky; top:96px; align-self:start; padding:10px; animation:rise .45s var(--ease) both}
    .dock h3{margin:0 0 8px; padding:8px 10px; border-bottom:1px solid var(--border); font-size:14px}
    .app{display:flex; align-items:center; gap:12px; padding:10px 12px; border-radius:18px; border:1px solid var(--border); background:rgba(255,255,255,.06); text-decoration:none; color:var(--text); font-weight:700; margin-bottom:10px; transition:transform .14s var(--ease), box-shadow .2s ease}
    .app:hover{transform:translateX(2px); box-shadow:var(--ring)}
    .app .icon{width:36px; height:36px; display:grid; place-items:center; border-radius:50%; background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#0b1020; font-weight:900; transition: transform .35s var(--ease)}
    .app:hover .icon{transform: rotate(8deg) scale(1.05)}

    .hero{padding:16px; display:grid; gap:14px; grid-template-columns:1.1fr 1fr}
    @media (max-width:1100px){ .hero{grid-template-columns:1fr} }
    .card{padding:16px; border-radius:20px; border:1px solid var(--border); background:var(--panel); box-shadow:var(--shadow); animation:pop .35s var(--ease) both, floaty 6s ease-in-out infinite; transform-origin: 50% 70%}
    .card h4{margin:0 0 10px; font-size:14px; letter-spacing:.3px; display:flex; align-items:center; gap:8px}
    .today{display:grid; gap:12px}
    .date{font-size:26px; font-weight:800}
    .quick{display:flex; gap:8px; flex-wrap:wrap}
    .pill-mini{display:inline-flex; align-items:center; gap:6px; padding:7px 10px; border-radius:999px; border:1px solid var(--border); background:rgba(255,255,255,.06); font-size:12px; color:var(--muted)}
    .agenda{display:grid; gap:8px}
    .agenda .row{display:grid; grid-template-columns:86px 1fr auto; gap:8px; align-items:center}
    .agenda-form{display:grid; gap:10px; padding:10px; border-radius:16px; border:1px dashed var(--border); background:rgba(255,255,255,.04)}
    .agenda-form .inputs{display:grid; grid-template-columns:140px 1fr; gap:10px}
    .agenda-form .inputs input{padding:9px 11px; border-radius:12px; border:1px solid var(--border); background:rgba(255,255,255,.06); color:var(--text)}
    .agenda-form .actions{display:flex; justify-content:flex-end}
    .agenda-form .actions .btn-cta{width:min(220px,100%)}
    @media (max-width:780px){ .agenda-form .inputs{grid-template-columns:1fr} .agenda-form .actions{justify-content:stretch} .agenda-form .actions .btn-cta{width:100%} }
    .note-box{display:grid; gap:8px}
    .note-box textarea{width:100%; min-height:110px; resize:vertical; padding:11px 12px; border-radius:16px; border:1px solid var(--border); background:rgba(255,255,255,.06); color:var(--text)}
    .notes-list{display:grid; gap:8px; max-height:220px; overflow:auto}
    .note-item{display:grid; gap:6px; padding:9px; border:1px solid var(--border); border-radius:14px; background:rgba(255,255,255,.06); animation:rise .35s var(--ease) both}
    .note-item .meta{display:flex; gap:8px; align-items:center; justify-content:space-between; color:var(--muted); font-size:12px}
    .note-item .actions{display:flex; gap:8px}
    .mood{display:grid; gap:12px}
    .mood-row{display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center}
    .mood-gauge{ --size:150px; width:var(--size); height:var(--size); border-radius:50%; position:relative; background:conic-gradient(from -90deg, #ef4444 0 20%, #f59e0b 20% 60%, #22c55e 60% 100%); border:1px solid var(--border); box-shadow:inset 0 0 30px rgba(0,0,0,.2); }
    .mood-gauge .center{ position:absolute; inset:12px; border-radius:50%; background:var(--panel); border:1px solid var(--border); display:grid; place-items:center; gap:6px; background-image: linear-gradient(90deg, rgba(255,255,255,.06) 25%, rgba(255,255,255,.12) 37%, rgba(255,255,255,.06) 63%); background-size: 400% 100%; animation: shimmer 2.4s linear infinite; }
    .mood-needle{ position:absolute; left:50%; top:50%; width:2px; height:calc(var(--size)/2 - 14px); background:var(--text); transform-origin:bottom center; transform:translate(-50%,-100%) rotate(0deg); transition: transform .6s var(--ease); }
    .mood-emoji{ font-size:26px }
    .mood-badge{display:inline-flex; align-items:center; gap:8px; padding:7px 10px; border-radius:14px; border:1px solid var(--border); background:rgba(255,255,255,.06); font-weight:700}
    .mood-legend{display:flex; justify-content:space-between; font-size:12px; color:var(--muted)}
    .chip{padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:rgba(255,255,255,.06); cursor:pointer; transition: transform .12s var(--ease); font-size:13px}
    .chip:hover{transform:translateY(-1px)}
    .history{display:flex; gap:6px; align-items:flex-end; height:46px}
    .bar{width:10px; background:linear-gradient(180deg, var(--accent2), var(--accent)); border-radius:6px}
    footer{margin:16px auto; width:max-content; font-size:12px}

    /* Ripple */
    .ripple{ position:absolute; border-radius:50%; transform:scale(0); animation:rip .6s var(--ease); pointer-events:none; background:radial-gradient(circle at center, rgba(255,255,255,.6), rgba(255,255,255,.2), transparent 70%); }
    @keyframes rip{to{transform:scale(8); opacity:0}}

    @media (prefers-reduced-motion: reduce){ .bg,.glow,.grid,.nav,.hero,.app,.card,.theme-dock,.fab,.mood-needle{ animation:none !important; transition:none !important } }

    /* Starfield canvas positioning.
       Se asegura que el lienzo ocupe la totalidad de la ventana y se sitúe detrás de los demás elementos.  El z-index negativo
       permite que el starfield quede bajo la capa de gradientes y brillo, contribuyendo a una sensación de profundidad sin
       impedir la interacción. */
    canvas.starfield{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index:-1;
    }

    /*
      Tarjeta de perfil y barra de nivel
      Este bloque define estilos para un nuevo panel situado al final de la página que muestra el avatar,
      nombre, nivel y correo electrónico del usuario, junto con una barra de progreso de la experiencia (XP).
    */
    .profile-card{
      display:grid;
      gap:12px;
    }
    .profile-card h4{
      margin:0 0 8px;
      font-size:14px;
      font-weight:800;
    }
    .profile-card .profile-info{
      display:flex;
      gap:16px;
      align-items:center;
      flex-wrap:wrap;
    }
    .profile-card .profile-avatar{
      display:grid;
      place-items:center;
      width:60px;
      height:60px;
      font-size:32px;
      border-radius:50%;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#0b1020;
      box-shadow:var(--shadow);
    }
    .profile-card .profile-level{
      font-size:14px;
      font-weight:700;
      min-width:68px;
    }
    .profile-card .level-bar{
      flex:1;
      height:8px;
      background:rgba(255,255,255,.14);
      border-radius:8px;
      overflow:hidden;
    }
    .profile-card .level-bar-fill{
      display:block;
      height:100%;
      width:0%;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      transition:width .3s var(--ease);
    }
    .profile-card .profile-email{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
      word-break:break-all;
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <!--
    Canvas de estrellas: un fondo animado que simula un cielo estrellado.  Se coloca detrás de los gradientes y de la cuadrícula para
    aportar profundidad visual sin entorpecer el contenido principal.  El script que inicializa y anima las estrellas se encuentra al final
    del documento y utiliza requestAnimationFrame para un rendimiento fluido.
  -->
  <canvas id="starfield" class="starfield" aria-hidden="true"></canvas>
  <div class="glow" aria-hidden="true"></div>
  <div class="grid" aria-hidden="true"></div>

  <div class="container">
    <!-- NAV -->
    <nav class="nav panel" role="navigation" aria-label="Principal">
      <div class="brand">
        <div class="logo" aria-label="Innove Planner"><span class="core" aria-hidden="true"></span></div>
        <span class="brand-name">Innove Planner</span>
      </div>
      <div class="nav-right">
        <div class="search" role="search"><span>🔎</span><input id="q" type="search" placeholder="Buscar…" aria-label="Buscar"/></div>
        <!-- Atajos rápidos: accesos directos para Gmail, Chats, Juegos y Editor de fotos. Estas pequeñas burbujas permiten abrir rápidamente estas funciones desde la barra de navegación. -->
        <div class="quick-apps">
          <a href="#" aria-label="Gmail" title="Gmail ✉️">✉️</a>
          <a href="#" aria-label="Chats" title="Chats 💬">💬</a>
          <a href="#" aria-label="Juegos" title="Games 🎮">🎮</a>
          <a href="index.html" aria-label="Editor de fotos" title="Editor de fotos ">🏠</a>
        </div>
        <div class="mode-switch" aria-label="Modo de color">
          <button id="navLight" type="button" aria-label="Modo claro" title="Modo claro 🌞">🌞</button>
          <button id="navDark" type="button" aria-label="Modo oscuro" title="Modo oscuro 🌜">🌜</button>
        </div>
        <!-- Perfil: nombre, emoji y nivel -->
        <div id="profile" class="profile" title="Tu perfil">
          <span id="profileIcon">🙂</span>
          <span id="profileName">Tu nombre</span>
          <span id="profileLevel" class="level-badge">Nv&nbsp;1</span>
        </div>
      </div>
    </nav>

    <div class="layout">
      <!-- BARRA LATERAL -->
      <aside class="dock panel" aria-label="Barra de inicio">
        <h3>Apps principales</h3>
        <a class="app" href="#"><span class="icon">📅</span><div>Administrador de día<br><small>Agenda y bloques</small></div></a>
        <a class="app" href="#"><span class="icon">🍽️</span><div>Alimentación<br><small>Comidas, macros, agua</small></div></a>
        <a class="app" href="#"><span class="icon">📝</span><div>Notas<br><small>Markdown y colecciones</small></div></a>
        <a class="app" href="#"><span class="icon">📖</span><div>Diario<br><small>Registro diario</small></div></a>
        <a class="app" href="#"><span class="icon">📆</span><div>Rutinas<br><small>Hábitos semanales</small></div></a>
        <a class="app" href="#"><span class="icon">😊</span><div>Ánimo<br><small>Mood tracking</small></div></a>

        <!-- Apps adicionales: Gmail, Chats, Juegos y Editor de fotos -->
        <a class="app" href="#"><span class="icon">✉️</span><div>Gmail<br><small>Correo electrónico</small></div></a>
        <a class="app" href="https://innove-chat-ai.netlify.app/"><span class="icon">💬</span><div>Chats<br><small>Mensajería rápida</small></div></a>
        <a class="app" href="#"><span class="icon">🎮</span><div>Games<br><small>Juegos</small></div></a>
        <a class="app" href="#"><span class="icon">🖼️</span><div>Editor de fotos<br><small>Herramienta fotográfica</small></div></a>
      </aside>

      <!-- MAIN -->
      <main style="display:grid; gap:16px; align-content:start;">
        <!-- HERO -->
        <section class="hero">
          <div class="card today panel">
            <h4>📅 Resumen del día</h4>
            <div class="date" id="dateLabel">—</div>
            <div class="quick">
              <button class="btn btn-cta" id="btnAddEvent">＋ Evento</button>
              <button class="btn" id="btnAddTask">＋ Tarea</button>
              <button class="btn" id="btnAddWater">＋ Agua</button>
              <span class="pill-mini" id="clock">--:--</span>
              <span class="pill-mini" id="water">💧 0/8</span>
            </div>
            <div id="agendaEditor" class="agenda-form">
              <div class="inputs">
                <input id="aTime" type="time" aria-label="Hora">
                <input id="aText" type="text" placeholder="Título del evento" aria-label="Título del evento">
              </div>
              <div class="actions">
                <button id="aAdd" class="btn btn-cta" type="button">Añadir a la agenda</button>
              </div>
            </div>
            <div class="agenda" id="agendaMini"></div>
          </div>

          <div class="card panel">
            <h4>📝 Nota rápida</h4>
            <div class="note-box">
              <textarea id="quickNote" placeholder="Escribe una idea… (Alt+N)"></textarea>
              <div style="display:flex; gap:8px; justify-content:flex-end;">
                <button id="saveNote" class="btn btn-cta" type="button">Guardar en biblioteca</button>
              </div>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:6px;">
              <strong>📚 Notas guardadas</strong>
              <div style="display:flex; gap:8px;">
                <button id="exportNotes" class="btn" type="button">⬇️ Exportar</button>
                <button id="clearNotes" class="btn" type="button" title="Borrar todas">🗑️ Limpiar</button>
              </div>
            </div>
            <div id="notesList" class="notes-list"></div>
          </div>
        </section>

        <!-- Estado + Links -->
        <section class="card panel" style="display:grid; gap:16px;">
          <h4>💛 Tu estado y accesos</h4>
          <div style="display:grid; grid-template-columns: 200px 1fr; gap:16px; align-items:center">
            <div class="mood-gauge" aria-label="Medidor de ánimo">
              <div id="needle" class="mood-needle"></div>
              <div class="center">
                <div class="mood-emoji" id="moodEmoji">🙂</div>
                <div id="moodLabel" style="font-weight:800">Neutro</div>
                <div id="moodValue" class="pill-mini">3/5</div>
              </div>
            </div>
            <div class="mood">
              <div class="mood-row">
                <div class="mood-badge">Ajusta tu estado</div>
                <input id="moodSlider" type="range" min="1" max="5" step="1" value="3" style="width:220px">
              </div>
              <div class="mood-legend"><span>⬤ Bajo</span><span>⬤ Medio</span><span>⬤ Alto</span></div>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button class="chip" data-mood="2">Calmado</button>
                <button class="chip" data-mood="3">Neutro</button>
                <button class="chip" data-mood="4">Productivo</button>
                <button class="chip" data-mood="5">Excelente</button>
              </div>
              <div>
                <div class="pill-mini" style="margin-bottom:6px">Historial reciente</div>
                <div id="moodHistory" class="history"></div>
              </div>
            </div>
          </div>

          <div class="links" id="links" style="display:flex; flex-wrap:wrap; gap:10px;"></div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <input id="linkName" type="text" placeholder="Nombre del link (ej. Planner avanzado)" style="flex:1; padding:10px 12px; border-radius:14px; border:1px solid var(--border); background:rgba(255,255,255,.06); color:var(--text);"/>
            <input id="linkUrl" type="text" placeholder="URL (o archivo .html)" style="flex:1; padding:10px 12px; border-radius:14px; border:1px solid var(--border); background:rgba(255,255,255,.06); color:var(--text);"/>
            <button class="btn" id="addLink" type="button" title="Añadir link (Alt+L)">＋ Link</button>
          </div>
        </section>

        <!-- Panel de perfil inferior -->
        <section class="card panel profile-card" id="profilePanel">
          <h4>👤 Perfil</h4>
          <div class="profile-info">
            <div class="profile-avatar" id="profileCardIcon">🙂</div>
            <div style="flex:1">
              <div><strong id="profileCardName">Tu nombre</strong></div>
              <div style="display:flex; align-items:center; gap:8px; margin-top:4px;">
                <span class="profile-level" id="profileCardLevel">Nivel 1</span>
                <div class="level-bar">
                  <span class="level-bar-fill" id="levelBarFill"></span>
                </div>
              </div>
              <div class="profile-email" id="profileCardEmail"></div>
            </div>
          </div>
        </section>

        <footer class="pill-mini">© 2025 Innove Planner · Alt+N nota · Alt+L link · Alt+T Temas</footer>
      </main>
    </div>
  </div>

  <!-- THEME DOCK (BOTTOM) — compacto y contrastado -->
  <div id="themeDock" class="theme-dock" aria-label="Temas">
    <div class="theme-bar">
      <div id="themesRow" class="themes"></div>
      <!-- Botón de cierre: permite ocultar los temas cómodamente -->
      <button id="closeDock" class="pill pill-close" type="button" aria-label="Cerrar temas">✕</button>
    </div>
  </div>
  <button id="openDock" class="fab" aria-label="Abrir temas" title="Abrir temas">🎨</button>

  <script>
  (function(){
    const SKEY='planner_state_oscuro_legible_responsive_v1';
    const state = JSON.parse(localStorage.getItem(SKEY) || '{}');
    const save=()=>localStorage.setItem(SKEY,JSON.stringify(state));
    const $=(s,r=document)=>r.querySelector(s); const $$=(s,r=document)=>[...r.querySelectorAll(s)];
    const metaTheme=document.getElementById('metaThemeColor');

    /* --------------------------------------------------------------
     * Definición de niveles y emojis
     * Cada nivel del 1 al 150 tiene asignado un emoji correspondiente.
     * Usamos una lista base de emojis variados y la repetimos para llenar
     * los 150 niveles. Los niveles se desbloquean de forma progresiva y
     * el usuario no puede editarlos manualmente.
     */
    /*
     * Definición extendida de emojis para los 150 niveles. Cada nivel desbloquea
     * un nuevo emoji, por lo que esta lista contiene 150 elementos únicos o casi únicos.
     * Las categorías incluyen caras, animales y otros íconos para mantener variedad.
     */
    const EMOJI_LEVELS = [
      '😀','😃','😄','😁','😆','😅','😂','🤣','😊','😇',
      '🙂','🙃','😉','😌','😍','🥰','😘','😗','😙','😚',
      '😋','😛','😝','😜','🤪','😎','🤓','🧐','🤠','🥳',
      '😏','😒','😞','😔','😟','😕','🙁','☹️','😣','😖',
      '😫','😩','🥺','😢','😭','😤','😠','😡','🤬','🤯',
      '😳','🥵','🥶','🥴','😵','😵‍💫','🤡','🤥','🫢','🤫',
      '🤗','🤔','🤭','🫤','😶','😐','😑','😬','🙄','😯',
      '😦','😧','😮','😲','🥱','😴','🤤','😪','😷','🤒',
      '🤕','🤢','🤮','🤧','🐶','🐱','🐭','🐹','🐰','🦊',
      '🐻','🐼','🐨','🐯','🦁','🐮','🐷','🐸','🐵','🙈',
      '🙉','🙊','🐔','🐧','🐦','🐤','🦆','🦅','🦉','🦇',
      '🐺','🦄','🐴','🦌','🐝','🐛','🦋','🐌','🐞','🐜',
      '🕷️','🦂','🐢','🐍','🦎','🦖','🦕','🐙','🦑','🦐',
      '🦞','🦀','🐡','🐠','🐟','🐬','🐳','🐋','🦈','🐊',
      '🦦','🦥','🦫','🦨','🦔','🦝','🐓','🐿️','🦡','🦭'
    ];

    /* fecha y reloj */
    $('#dateLabel').textContent = new Date().toLocaleDateString('es-ES',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
    function tick(){ $('#clock').textContent = new Date().toLocaleTimeString('es-ES',{hour:'2-digit',minute:'2-digit'}); } tick(); setInterval(tick,30000);

    /* ripple on click */
    function addRipples(scope=document){ scope.addEventListener('click', (e)=>{
      const target = e.target.closest('.btn, .pill, .mode-switch button');
      if(!target) return;
      const rect = target.getBoundingClientRect();
      const r = Math.max(rect.width, rect.height);
      const ripple = document.createElement('span');
      ripple.className='ripple';
      ripple.style.width=ripple.style.height = r+'px';
      ripple.style.left = (e.clientX-rect.left - r/2) + 'px';
      ripple.style.top  = (e.clientY-rect.top  - r/2) + 'px';
      target.appendChild(ripple);
      setTimeout(()=> ripple.remove(), 650);
    });}
    addRipples(document);

    /* agenda */
    state.agenda = Array.isArray(state.agenda)? state.agenda : [{h:'08:00',t:'Desayuno'},{h:'10:00',t:'Focus'},{h:'14:00',t:'Almuerzo'}];
    function renderAgenda(){
      const el=$('#agendaMini'); if(!state.agenda.length){ el.innerHTML='<div class="pill-mini">Sin eventos</div>'; return; }
      el.innerHTML = state.agenda.map((i,idx)=>`<div class="row"><div class="pill-mini">${i.h}</div><div>${i.t}</div><div style="display:flex;gap:6px"><button class="btn" data-del="${idx}" title="Eliminar">🗑️</button></div></div>`).join('');
      $$('[data-del]').forEach(b=> b.addEventListener('click',()=>{ state.agenda.splice(+b.dataset.del,1); save(); renderAgenda(); spark(b); }));
    } renderAgenda();
    $('#aAdd').addEventListener('click',()=>{ const h=$('#aTime').value; const t=$('#aText').value.trim(); if(!h||!t) return; state.agenda.push({h,t}); state.agenda.sort((a,b)=>a.h.localeCompare(b.h)); save(); $('#aTime').value=''; $('#aText').value=''; renderAgenda(); spark($('#aAdd')); });

    /* agua */
    state.water = Number.isFinite(state.water)?state.water:0; function rWater(){ $('#water').textContent=`💧 ${state.water}/8`; } rWater();
    $('#btnAddWater').addEventListener('click',()=>{ state.water=Math.min(8,(state.water||0)+1); save(); rWater(); bubbles($('#btnAddWater')); gainXP(5); });

    /* quick notes -> biblioteca */
    state.notes = Array.isArray(state.notes)? state.notes : [];
    $('#saveNote').addEventListener('click',()=>{
      const txt=$('#quickNote').value.trim(); if(!txt) return;
      const note={id:Date.now(), text:txt, ts:new Date().toISOString(), pin:false};
      state.notes.unshift(note); $('#quickNote').value=''; save(); renderNotes(); spark($('#saveNote')); gainXP(7);
    });
    $('#exportNotes').addEventListener('click',()=>{
      const data = 'data:application/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(state.notes,null,2));
      const a = document.createElement('a'); a.href=data; a.download='notas_innove.json'; a.click();
    });
    $('#clearNotes').addEventListener('click',()=>{ if(confirm('¿Borrar todas las notas guardadas?')){ state.notes=[]; save(); renderNotes(); }});
    function renderNotes(){
      const list=$('#notesList');
      if(!state.notes.length){ list.innerHTML='<div class="pill-mini">Aún no hay notas guardadas</div>'; return; }
      const sorted=[...state.notes].sort((a,b)=> (b.pin?-1:0) - (a.pin?-1:0) || b.id-a.id);
      list.innerHTML = sorted.map(n=>`<div class="note-item">
        <div class="meta"><span>${new Date(n.ts).toLocaleString('es-ES')}</span>
          <div class="actions">
            <button class="btn" data-pin="${n.id}" title="Fijar">${n.pin?'📌 Quit.':'📌 Fijar'}</button>
            <button class="btn" data-delnote="${n.id}" title="Eliminar">🗑️</button>
          </div>
        </div>
        <div>${escapeHtml(n.text)}</div>
      </div>`).join('');
      $$('[data-delnote]').forEach(b=> b.addEventListener('click',()=>{ const id=+b.dataset.delnote; state.notes = state.notes.filter(x=>x.id!==id); save(); renderNotes(); }));
      $$('[data-pin]').forEach(b=> b.addEventListener('click',()=>{ const id=+b.dataset.pin; const n=state.notes.find(x=>x.id===id); n.pin=!n.pin; save(); renderNotes(); }));
    }
    const escapeHtml = (s)=> s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    renderNotes();

    /* Links */
    state.links = Array.isArray(state.links)? state.links : [];
    function renderLinks(){ const el=$('#links'); el.innerHTML = state.links.length ? state.links.map(l=>`<a class="pill" href="${l.url}" target="_blank" rel="noopener">🔗 ${l.name}</a>`).join('') : `<span class="pill-mini">Añade tus accesos rápidos</span>`; }
    renderLinks();
    $('#addLink').addEventListener('click',()=>{ const name=$('#linkName').value.trim(), url=$('#linkUrl').value.trim(); if(!name||!url) return; state.links.push({name,url}); $('#linkName').value=''; $('#linkUrl').value=''; save(); renderLinks(); spark($('#addLink')); gainXP(5); });

    /* Search */
    $('#q').addEventListener('input',()=>{ const t=$('#q').value.toLowerCase(); $$('.app').forEach(a=> a.style.display = a.textContent.toLowerCase().includes(t)?'':'none'); });

    /* Mood */
    state.mood = Number.isFinite(state.mood)? state.mood : 3;
    state.moodHistory = Array.isArray(state.moodHistory)? state.moodHistory : [3];
    const moodMap={1:['😞','Muy bajo'],2:['🙁','Bajo'],3:['🙂','Neutro'],4:['😊','Bien'],5:['🤩','Excelente']};
    function setMood(v, addHistory=true){
      state.mood=v; const [e,l]=moodMap[v]||moodMap[3];
      $('#moodEmoji').textContent=e; $('#moodLabel').textContent=l; $('#moodValue').textContent=`${v}/5`;
      const deg = (-90) + (v-1)*(180/4);
      $('#needle').style.transform = `translate(-50%,-100%) rotate(${deg}deg)`;
      $('#moodSlider').value=v;
      if(addHistory){ state.moodHistory.push(v); if(state.moodHistory.length>12) state.moodHistory.shift(); }
      save(); renderMoodHistory();
      if(v===5) confetti();
      // Ganamos un poco de XP cada vez que ajustamos el estado de ánimo
      gainXP(3);
    }
    function renderMoodHistory(){
      const el=$('#moodHistory'); el.innerHTML=''; state.moodHistory.forEach(v=>{ const b=document.createElement('div'); b.className='bar'; b.style.height = `${10 + v*6}px`; el.appendChild(b); });
    }
    $$('.chip').forEach(c=> c.addEventListener('click',()=>setMood(+c.dataset.mood)));
    $('#moodSlider').addEventListener('input',e=> setMood(+e.target.value, false));
    setMood(state.mood, false);

    /* THEMES (chips) */
    const THEMES = {
      planetado: {
        key: 'planetado',
        name: 'Planetado',
        accent: '#60a5fa',
        accent2: '#a78bfa',
        bgTop: '#0b132b',
        bgMiddle: '#0d1b2a',
        bgBottom: '#020b20'
      },
      neon: {
        key: 'neon',
        name: 'Neón',
        accent: '#8b5cf6',
        accent2: '#22d3ee',
        bgTop: '#1f133d',
        bgMiddle: '#0d203d',
        bgBottom: '#041225'
      },
      aurora: {
        key: 'aurora',
        name: 'Aurora',
        accent: '#22d3ee',
        accent2: '#34d399',
        bgTop: '#042f2e',
        bgMiddle: '#012b27',
        bgBottom: '#001f1e'
      },
      hoja: {
        key: 'hoja',
        name: 'Hoja',
        accent: '#34d399',
        accent2: '#22c55e',
        bgTop: '#0c3524',
        bgMiddle: '#022915',
        bgBottom: '#011a0f'
      },
      plateado: {
        key: 'plateado',
        name: 'Plateado',
        accent: '#94a3b8',
        accent2: '#e2e8f0',
        bgTop: '#20233a',
        bgMiddle: '#282c47',
        bgBottom: '#1a1d32'
      },
      mar: {
        key: 'mar',
        name: 'Mar',
        accent: '#7dd3fc',
        accent2: '#38bdf8',
        bgTop: '#0a2342',
        bgMiddle: '#062d4d',
        bgBottom: '#041a31'
      }
    };
    const row = $('#themesRow');
    // Crear botones de temas dinámicamente y asociar la key en data-theme
    Object.entries(THEMES).forEach(([key, t]) => {
      const b = document.createElement('button');
      b.className = 'pill';
      b.type = 'button';
      b.dataset.theme = key;
      b.innerHTML = `<span class="dot" style="background:linear-gradient(135deg, ${t.accent}, ${t.accent2})"></span> <span class="label">${t.name}</span>`;
      b.addEventListener('mousemove', (e) => {
        const r = b.getBoundingClientRect();
        const dx = (e.clientX - (r.left + r.width / 2)) / r.width * 4;
        const dy = (e.clientY - (r.top + r.height / 2)) / r.height * 4;
        b.style.transform = `translate(${dx}px, ${dy}px)`;
      });
      b.addEventListener('mouseleave', () => b.style.transform = '');
      b.addEventListener('click', () => setAccent(key));
      row.appendChild(b);
    });

    function setAccent(themeOrAccent, accent2Maybe) {
      const root = document.documentElement;
      let theme;
      // Si se pasa un nombre de tema
      if (typeof themeOrAccent === 'string' && accent2Maybe === undefined) {
        theme = THEMES[themeOrAccent] || THEMES.planetado;
      } else if (typeof themeOrAccent === 'string' && typeof accent2Maybe === 'string') {
        // Compatibilidad: buscar tema por colores
        theme = Object.values(THEMES).find(t => t.accent === themeOrAccent && t.accent2 === accent2Maybe) || THEMES.planetado;
      } else if (typeof themeOrAccent === 'object') {
        theme = themeOrAccent;
      } else {
        theme = THEMES.planetado;
      }
      // Establecer variables CSS para colores y fondos
      root.style.setProperty('--accent', theme.accent);
      root.style.setProperty('--accent2', theme.accent2);
      root.style.setProperty('--bg-top', theme.bgTop);
      root.style.setProperty('--bg-middle', theme.bgMiddle);
      root.style.setProperty('--bg-bottom', theme.bgBottom);
      // Guardar estado y compatibilidad con versiones anteriores
      state.theme = theme.key;
      state.accent = theme.accent;
      state.accent2 = theme.accent2;
      save();
      glow();
      highlightActive(theme.key);
    }
    function highlightActive(themeKey) {
      $$('.pill', row).forEach(p => p.classList.remove('active'));
      const btn = row.querySelector(`[data-theme="${themeKey}"]`);
      if (btn) btn.classList.add('active');
    }

    /* MODO desde NAV con ☀️/🌙 */
    function setScheme(scheme){
      document.documentElement.setAttribute('data-scheme', scheme);
      // Ajustamos el color del meta theme para que coincida con el fondo del modo
      metaTheme.content = scheme==='light' ? '#f5f8fe' : '#0d152f';
      state.scheme = scheme; save();
      $('#navLight').classList.toggle('active', scheme==='light');
      $('#navDark').classList.toggle('active', scheme==='dark');
      $('#navLight').setAttribute('aria-pressed', scheme==='light');
      $('#navDark').setAttribute('aria-pressed', scheme==='dark');
    }
    function initThemeFromState(){
      const scheme = state.scheme || 'dark';
      setScheme(scheme);
      // Aplicar el tema guardado o, si no hay, mapear colores antiguos
      if(state.theme){
        setAccent(state.theme);
      } else if(state.accent && state.accent2){
        setAccent(state.accent, state.accent2);
      } else {
        setAccent('planetado');
      }
    }
    $('#navLight').addEventListener('click',()=> setScheme('light'));
    $('#navDark').addEventListener('click', ()=> setScheme('dark'));
    initThemeFromState();

    /* ------------------------------------------------------------------
     * Perfil y modal
     * Se inicializan valores por defecto de nombre, email, contraseña,
     * emoji y nivel. Estos se guardan en localStorage. El perfil se
     * muestra en la esquina superior derecha y es editable desde una
     * ventana modal. El nivel se muestra como una pequeña insignia.
     */
    state.name = typeof state.name === 'string' ? state.name : '';
    state.email = typeof state.email === 'string' ? state.email : '';
    state.password = typeof state.password === 'string' ? state.password : '';
    // Inicializamos nivel entre 1 y 150 y asignamos el emoji correspondiente al nivel.
    state.level = Number.isFinite(state.level) ? Math.min(150, Math.max(1, state.level)) : 1;
    state.emoji = EMOJI_LEVELS[state.level - 1];
    // Inicializamos la experiencia (XP). Si no existe, comenzamos en 0.
    state.xp = Number.isFinite(state.xp) ? state.xp : 0;
    // Guardamos inmediatamente en caso de que el nivel o emoji se hayan ajustado por primera vez
    save();
    function renderProfile(){
      const name = state.name && state.name.trim() ? state.name.trim() : 'Tu nombre';
      $('#profileName').textContent = name;
      $('#profileIcon').textContent = state.emoji || '🙂';
      $('#profileLevel').textContent = 'Nv ' + (state.level || 1);
      // Actualizamos también la tarjeta inferior del perfil
      updateProfileCard();
    }

    /*
      Actualiza la tarjeta del perfil en la parte inferior con el nombre, correo, nivel y progreso de XP.
      Si la tarjeta aún no existe (por ejemplo, en pantallas muy pequeñas donde podría ocultarse), la función retorna sin hacer nada.
    */
    function updateProfileCard(){
      const cardName = $('#profileCardName');
      if(!cardName) return;
      const name = state.name && state.name.trim() ? state.name.trim() : 'Tu nombre';
      cardName.textContent = name;
      const cardIcon = $('#profileCardIcon');
      if(cardIcon) cardIcon.textContent = state.emoji || '🙂';
      const cardLevel = $('#profileCardLevel');
      if(cardLevel) cardLevel.textContent = 'Nivel ' + (state.level || 1);
      const cardEmail = $('#profileCardEmail');
      if(cardEmail) cardEmail.textContent = state.email || '';
      updateLevelBar();
    }

    /*
      Actualiza la barra de nivel (XP) ajustando su ancho en función de la experiencia acumulada.
      El ancho se calcula en porcentaje sobre 100 XP.  Si la barra no existe todavía,
      la función se detiene silenciosamente.
    */
    function updateLevelBar(){
      const bar = $('#levelBarFill');
      if(!bar) return;
      const xp = Number.isFinite(state.xp) ? state.xp % 100 : 0;
      bar.style.width = xp + '%';
    }

    /*
      Incrementa la experiencia del usuario y maneja el avance de nivel. Si se supera 100 XP,
      se incrementa el nivel, se ajusta la XP sobrante y se actualiza el emoji del nivel.  También
      se dispara confeti para celebrar el cambio de nivel. Finalmente, se guarda el estado y se
      actualiza el perfil.
    */
    function gainXP(amount){
      state.xp = Number.isFinite(state.xp) ? state.xp : 0;
      state.xp += amount;
      while(state.xp >= 100){
        state.xp -= 100;
        state.level = Math.min(150, (state.level || 1) + 1);
        // Aseguramos que el emoji se actualice según el nuevo nivel
        state.emoji = EMOJI_LEVELS[state.level - 1];
        confetti();
      }
      save();
      renderProfile();
    }
    function openProfileModal(){
      $('#formName').value = state.name || '';
      $('#formEmail').value = state.email || '';
      $('#formPassword').value = state.password || '';
      // Actualizamos el selector de emoji para mostrar solo el emoji actual del nivel
      const selectEl = $('#formEmoji');
      selectEl.innerHTML = `<option value="${state.emoji}">${state.emoji}</option>`;
      selectEl.value = state.emoji || '🙂';
      // Deshabilitamos el selector de emoji y el control de nivel para evitar que se editen manualmente
      selectEl.disabled = true;
      $('#formLevel').value = state.level || 1;
      $('#formLevel').disabled = true;
      $('#levelValue').textContent = $('#formLevel').value;
      $('#profileModal').classList.add('show');
    }
    function closeProfileModal(){
      $('#profileModal').classList.remove('show');
    }
    // Inicializa el perfil y asigna los eventos cuando el DOM esté listo para garantizar que los elementos existan
    function initProfileBindings(){
      renderProfile();
      const prof = $('#profile');
      if(prof) prof.addEventListener('click', openProfileModal);
      const cBtn = $('#cancelProfile');
      if(cBtn) cBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        closeProfileModal();
      });
      const sBtn = $('#saveProfile');
      if(sBtn) sBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        state.name = $('#formName').value.trim();
        state.email = $('#formEmail').value.trim();
        state.password = $('#formPassword').value.trim();
        // Los campos emoji y nivel están bloqueados; no actualizamos el nivel ni el emoji manualmente.
        save();
        renderProfile();
        closeProfileModal();
      });
      const lvl = $('#formLevel');
      if(lvl) lvl.addEventListener('input', (e)=>{
        const val = e.target.value;
        $('#levelValue').textContent = val;
      });
    }
    // Espera al evento DOMContentLoaded para asegurar que la ventana modal y los campos están presentes
    document.addEventListener('DOMContentLoaded', initProfileBindings);

    /* Dock open/close */
    const dock = $('#themeDock');
    const openBtn = $('#openDock');
    const closeBtn = $('#closeDock');
    state.dockClosed = state.dockClosed ?? true;
    function applyDock(){
      if(state.dockClosed){
        dock.style.transform = 'translate(-50%, 140%)';
        dock.style.opacity   = '0';
        openBtn.classList.remove('active');
      } else {
        dock.style.transform = 'translate(-50%, 0)';
        dock.style.opacity   = '1';
        openBtn.classList.add('active');
      }
    }
    // El botón de la paleta actúa como interruptor: abre y cierra la barra
    if(openBtn){
      openBtn.addEventListener('click', () => {
        state.dockClosed = !state.dockClosed;
        save();
        applyDock();
      });
    }
    // Botón de cierre dentro del dock
    if(closeBtn){
      closeBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        state.dockClosed = true;
        save();
        applyDock();
      });
    }
    applyDock();

    /* Parallax leve del fondo */
    window.addEventListener('mousemove', (e)=>{
      const x=(e.clientX/window.innerWidth-.5)*6, y=(e.clientY/window.innerHeight-.5)*6;
      $('.bg').style.transform = `translate(${x}px,${y}px)`;
    });

    /* Scroll reveal */
    const io = new IntersectionObserver(entries=>{
      entries.forEach(ent=>{ if(ent.isIntersecting){ ent.target.style.animationPlayState='running'; io.unobserve(ent.target);} });
    },{threshold:.12});
    $$('.card').forEach(c=>{ c.style.animationPlayState='paused'; io.observe(c); });

    /* shortcuts */
    window.addEventListener('keydown', (e)=>{
      const ae=document.activeElement; const typing=ae && (ae.tagName==='INPUT'||ae.tagName==='TEXTAREA'||ae.isContentEditable);
      if(typing) return; const k=e.key.toLowerCase();
      if(e.altKey && k==='n'){ $('#quickNote').focus(); e.preventDefault(); }
      if(e.altKey && k==='l'){ $('#linkName').focus(); e.preventDefault(); }
      if(e.altKey && k==='t'){ state.dockClosed=!state.dockClosed; save(); applyDock(); e.preventDefault(); }
    });

    /* FX helpers */
    function spark(el){
      const r=el.getBoundingClientRect(); const cx=r.left+r.width/2, cy=r.top+r.height/2;
      for(let i=0;i<12;i++){ const s=document.createElement('span');
        const size=4+Math.random()*6; const angle=Math.random()*Math.PI*2; const dist=16+Math.random()*26;
        s.style.cssText=`position:fixed; left:${cx}px; top:${cy}px; width:${size}px; height:${size}px; border-radius:50%; background:linear-gradient(135deg,var(--accent),var(--accent2)); pointer-events:none; z-index:80; transform:translate(-50%,-50%)`;
        document.body.appendChild(s);
        requestAnimationFrame(()=>{
          s.style.transition='transform .6s var(--ease), opacity .6s var(--ease)';
          s.style.transform=`translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
          s.style.opacity='0';
        });
        setTimeout(()=>s.remove(), 650);
      }
    }
    function bubbles(el){
      const r=el.getBoundingClientRect(); const x=r.left+r.width/2, y=r.top;
      for(let i=0;i<6;i++){ const b=document.createElement('i'); const size=6+Math.random()*9;
        b.style.cssText=`position:fixed; left:${x}px; top:${y}px; width:${size}px; height:${size}px; border-radius:50%; background:radial-gradient(circle at 30% 30%, #fff, var(--accent)); opacity:.9; pointer-events:none; z-index:80`;
        document.body.appendChild(b);
        const dx=(Math.random()-.5)*36, dy=-(60+Math.random()*56), dur=800+Math.random()*600;
        b.animate([{transform:'translate(0,0)',opacity:.9},{transform:`translate(${dx}px, ${dy}px)`,opacity:0}],{duration:dur,easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish=()=>b.remove();
      }
    }
    function confetti(){
      for(let i=0;i<20;i++){
        const c=document.createElement('i'); const size=6+Math.random()*7;
        c.style.cssText=`position:fixed; left:${Math.random()*100}vw; top:-20px; width:${size}px; height:${size}px; background:linear-gradient(135deg,var(--accent),var(--accent2)); transform:rotate(${Math.random()*360}deg); opacity:.9; z-index:80`;
        document.body.appendChild(c);
        const dur=900+Math.random()*900; c.animate([{transform:`translateY(0) rotate(0deg)`},{transform:`translateY(${window.innerHeight+60}px) rotate(${120+Math.random()*180}deg)`}],{duration:dur,easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish=()=>c.remove();
      }
    }
    function glow(){ const g=document.createElement('div'); g.style.cssText='position:fixed; inset:0; background:radial-gradient(800px 480px at 50% 100%, rgba(125,211,252,.16), transparent 60%); pointer-events:none; z-index:-2; animation:fade 1.6s ease both'; document.body.appendChild(g); setTimeout(()=>g.remove(), 1600); }
  })();
  </script>

  <!-- Modal para personalizar el perfil -->
  <div id="profileModal" class="modal" aria-hidden="true">
    <!-- Modal content no utiliza la clase panel para evitar el fondo oscuro; el estilo se controla desde CSS -->
    <div class="modal-content">
      <h3>Personaliza tu perfil</h3>
      <label>Nombre
        <input id="formName" type="text" placeholder="Introduce tu nombre" />
      </label>
      <label>Gmail
        <input id="formEmail" type="email" placeholder="tuusuario@gmail.com" />
      </label>
      <label>Contraseña
        <input id="formPassword" type="password" placeholder="••••••" />
      </label>
      <label>Emoji
        <select id="formEmoji" disabled>
          <option value="🙂">🙂 Feliz</option>
          <option value="😎">😎 Cool</option>
          <option value="🤓">🤓 Nerd</option>
          <option value="😊">😊 Sonrisa</option>
          <option value="🤯">🤯 Asombro</option>
        </select>
      </label>
      <label style="display:flex; align-items:center; gap:8px;">Nivel
        <input id="formLevel" type="range" min="1" max="150" step="1" style="flex:1" disabled />
        <span id="levelValue" style="min-width:32px; text-align:center;">1</span>
      </label>
      <div class="buttons">
        <button id="cancelProfile" class="btn" type="button">Cancelar</button>
        <button id="saveProfile" class="btn btn-cta" type="button">Guardar</button>
      </div>
    </div><!-- .modal-content -->
  </div><!-- #profileModal -->

  <!-- Starfield animation script: este bloque inicializa y anima el lienzo de estrellas situado detrás de
       la cuadrícula y los gradientes.  Genera un conjunto de estrellas con posiciones aleatorias y
       velocidades variadas basadas en variables CSS (--star-count y --star-speed).  Al redimensionar
       la ventana se recalculan las posiciones para evitar distorsiones.  Utiliza requestAnimationFrame
       para optimizar el renderizado y asegurar una animación fluida. -->
  <script>
  (function(){
    const canvas = document.getElementById('starfield');
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    let starCount = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--star-count')) || 80;
    let speedBase = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--star-speed')) || 0.03;
    let stars = [];
    function resize(){
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      stars = [];
      for(let i=0; i<starCount; i++){
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 2 + 0.4,
          speed: (Math.random() * speedBase + speedBase)
        });
      }
    }
    function step(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      for(const s of stars){
        s.y += s.speed;
        if(s.y > canvas.height) s.y = 0;
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.size, 0, Math.PI*2);
        ctx.fill();
      }
      requestAnimationFrame(step);
    }
    window.addEventListener('resize', resize);
    resize();
    step();
  })();
  </script>
</body>
</html>


