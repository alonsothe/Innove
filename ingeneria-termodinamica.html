<!DOCTYPE html>
<html lang="es" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innove | Termodin√°mica UPC</title>
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- TAILWIND -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              display: ['Space Grotesk', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
            },
            colors: {
              brand: {
                50: '#fff1f2',
                100: '#ffe4e6',
                500: '#f43f5e', // Rose
                600: '#e11d48',
                900: '#881337',
              },
              dark: {
                bg: '#050505',
                card: '#111111',
                sidebar: '#0a0a0a',
                border: 'rgba(255, 255, 255, 0.08)',
              }
            }
          }
        }
      }
    </script>

    <!-- MATHJAX -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$']],
          processEscapes: true,
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .animate-fadeInUp { animation: fadeInUp 0.6s ease-out backwards; }
        .animate-slideDown { animation: slideDown 0.6s ease-out; }
        .animate-slideInRight { animation: slideInRight 0.5s ease-out backwards; }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #334155;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-dark-bg dark:text-white transition-colors duration-300 overflow-hidden h-screen flex font-sans">

    <!-- SIDEBAR -->
    <aside class="w-20 lg:w-[280px] h-full bg-white dark:bg-dark-sidebar border-r border-slate-200 dark:border-dark-border flex flex-col p-4 z-10 transition-all duration-300 shrink-0">
        <!-- Brand -->
        <div class="flex items-center gap-3 mb-10 px-2 justify-center lg:justify-start">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-500 to-brand-600 flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-brand-500/30">
                Q
            </div>
            <span class="hidden lg:block font-display text-xl font-bold tracking-tight">Innove</span>
        </div>

        <!-- Navigation -->
        <nav class="flex flex-col gap-2 flex-1 overflow-y-auto" id="nav-container">
            <!-- Generated by JS -->
        </nav>

        <!-- Footer Stats -->
        <div class="hidden lg:block mt-auto pt-6 border-t border-slate-200 dark:border-dark-border">
            <div class="bg-slate-100 dark:bg-white/5 p-4 rounded-xl">
                <div class="flex justify-between mb-2 text-sm font-medium">
                    <span class="text-slate-500 dark:text-slate-400">Progreso</span>
                    <span class="text-brand-600 dark:text-brand-500" id="progress-text">0/0</span>
                </div>
                <div class="w-full h-1.5 bg-slate-200 dark:bg-white/10 rounded-full overflow-hidden">
                    <div class="h-full w-0 bg-brand-500 rounded-full transition-all duration-500" id="progress-bar"></div>
                </div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 h-full overflow-y-auto p-5 md:p-10 relative scroll-smooth" id="main-scroll">
        
        <!-- Header -->
        <header class="flex justify-between items-end mb-10 animate-slideDown">
            <div>
                <h1 class="font-display text-3xl md:text-4xl font-bold mb-2 text-slate-900 dark:text-white">
                    Termodin√°mica Ingenier√≠a
                </h1>
                <p class="text-slate-500 dark:text-slate-400 max-w-2xl leading-relaxed">
                    Ejercicios resueltos de Termodin√°mica (295024). 1¬∫ y 2¬∫ Principio, Ciclos, Entrop√≠a y Transmisi√≥n de Calor.
                </p>
            </div>
            
            <button 
                id="theme-toggle"
                class="w-12 h-12 rounded-xl border border-slate-200 dark:border-dark-border flex items-center justify-center text-xl hover:bg-slate-100 dark:hover:bg-white/5 transition-colors"
                aria-label="Toggle Theme"
            >
                ‚òÄÔ∏è
            </button>
        </header>

        <!-- Mobile Filters -->
        <div class="flex lg:hidden gap-3 mb-8 overflow-x-auto pb-2 no-scrollbar" id="mobile-filters">
             <!-- Generated by JS -->
        </div>

        <!-- Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 pb-20" id="exercise-grid">
             <!-- Generated by JS -->
        </div>
    </main>

    <!-- MODAL -->
    <div id="modal-backdrop" class="fixed inset-0 bg-slate-900/40 dark:bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 md:p-8 transition-all duration-300 opacity-0 invisible pointer-events-none">
        <div id="modal-content" class="w-full max-w-5xl h-[90vh] bg-white dark:bg-[#0f0f0f] rounded-3xl shadow-2xl flex flex-col overflow-hidden border border-slate-200 dark:border-dark-border transition-all duration-300 scale-95 translate-y-10">
            
            <!-- Modal Header -->
            <div class="px-8 py-6 border-b border-slate-200 dark:border-dark-border flex justify-between items-center bg-slate-50 dark:bg-dark-card shrink-0">
                <div>
                    <h2 id="modal-title" class="font-display text-2xl font-bold text-slate-900 dark:text-white mb-1">
                        <!-- Title -->
                    </h2>
                    <span id="modal-id" class="font-mono text-sm text-brand-600 dark:text-brand-400">
                        <!-- ID -->
                    </span>
                </div>
                <button 
                    onclick="closeModal()"
                    class="w-10 h-10 rounded-full bg-slate-200 dark:bg-white/10 text-slate-500 dark:text-slate-400 flex items-center justify-center hover:bg-brand-500 hover:text-white hover:rotate-90 transition-all duration-300"
                >
                    ‚úï
                </button>
            </div>

            <!-- Modal Body -->
            <div class="flex-1 overflow-y-auto p-6 md:p-10 grid grid-cols-1 lg:grid-cols-2 gap-10">
                
                <!-- Problem Section -->
                <div class="lg:border-r border-slate-200 dark:border-dark-border lg:pr-10">
                    <span class="text-xs font-mono font-bold text-brand-600 dark:text-brand-400 uppercase tracking-widest mb-4 block">
                        Enunciado
                    </span>
                    <div id="modal-problem" class="text-lg md:text-xl leading-relaxed text-slate-800 dark:text-slate-200 font-medium">
                        <!-- Problem Text -->
                    </div>
                    
                    <div class="mt-8 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-900/30 rounded-xl">
                        <p class="text-sm text-blue-800 dark:text-blue-300 flex gap-2">
                            <span>üí°</span> 
                            <span>
                                <strong>Tip UPC:</strong> Aseg√∫rate de usar unidades del SI (Kelvin, Pascales, Julios) a menos que se indique lo contrario. R = 8.314 J/mol¬∑K.
                            </span>
                        </p>
                    </div>
                </div>

                <!-- Solution Section -->
                <div>
                    <span class="text-xs font-mono font-bold text-brand-600 dark:text-brand-400 uppercase tracking-widest mb-6 block">
                        Soluci√≥n Paso a Paso
                    </span>
                    
                    <div id="modal-steps" class="flex flex-col gap-4">
                        <!-- Steps injected here -->
                    </div>

                    <div class="mt-8 p-6 bg-emerald-50 dark:bg-emerald-500/10 border border-emerald-200 dark:border-emerald-500/30 rounded-xl text-center">
                        <span class="text-xs font-bold text-emerald-600 dark:text-emerald-400 uppercase tracking-widest mb-2 block">
                            Resultado Final
                        </span>
                        <div id="modal-solution" class="text-2xl font-display font-bold text-emerald-700 dark:text-emerald-400">
                            <!-- Solution -->
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- LOGIC -->
    <script>
        // --- DATA ---
        const exercises = [
            // ==========================================
            // 1. FUNDAMENTOS (BASICS)
            // ==========================================
            {
                id: "TER-001", category: "basics", topic: "Conversi√≥n Temperatura", difficulty: "Easy",
                problem: "Convierta 25¬∞C a Kelvin y Fahrenheit.",
                steps: ["$K = 25 + 273.15 = 298.15$.", "$F = (25 \\times 9/5) + 32 = 45 + 32 = 77$."],
                solution: "$$ 298.15 \\text{ K}, 77^{\\circ}\\text{F} $$"
            },
            {
                id: "TER-002", category: "basics", topic: "Gas Ideal PV=nRT", difficulty: "Easy",
                problem: "Calcule el volumen de 2 moles de gas ideal a 300K y 100 kPa ($R=8.314$).",
                steps: ["$V = nRT/P$.", "$2(8.314)(300) / 100000 = 4988.4 / 100000$."],
                solution: "$$ 0.0499 \\text{ m}^3 $$"
            },
            {
                id: "TER-005", category: "basics", topic: "Calorimetr√≠a (Mezcla)", difficulty: "Medium",
                problem: "Mezcla de 1kg de agua a 80¬∞C con 1kg a 20¬∞C. $T_f$?",
                steps: ["$mc(80-T) = mc(T-20)$.", "$80-T = T-20 \\Rightarrow 2T=100$."],
                solution: "$$ 50^{\\circ}\\text{C} $$"
            },
            {
                id: "TER-006", category: "basics", topic: "Expansi√≥n T√©rmica", difficulty: "Easy",
                problem: "Barra acero 1m, $\\alpha=12\\times 10^{-6}$. $\\Delta T = 50^{\\circ}$C. $\\Delta L$?",
                steps: ["$\\Delta L = L_0 \\alpha \\Delta T$.", "$1(12\\times 10^{-6})(50) = 600\\mu$m."],
                solution: "$$ 0.6 \\text{ mm} $$"
            },
            {
                id: "TER-011", category: "basics", topic: "Entalp√≠a Definici√≥n", difficulty: "Easy",
                problem: "$U=200$ kJ, $P=100$ kPa, $V=0.5$ m3. Calcule $H$.",
                steps: ["$H = U + PV$.", "$200 + 100(0.5) = 250$."],
                solution: "$$ 250 \\text{ kJ} $$"
            },
            {
                id: "TER-013", category: "basics", topic: "Calor Latente", difficulty: "Easy",
                problem: "Fundir 2kg hielo ($L_f = 334$ kJ/kg). Calor?",
                steps: ["$Q = mL$.", "$2(334)$."],
                solution: "$$ 668 \\text{ kJ} $$"
            },
            {
                id: "TER-014", category: "basics", topic: "Presi√≥n Manom√©trica", difficulty: "Easy",
                problem: "$P_{abs}=150$ kPa, $P_{atm}=101$ kPa. $P_{man}$?",
                steps: ["150 - 101."],
                solution: "$$ 49 \\text{ kPa} $$"
            },
            {
                id: "TER-016", category: "basics", topic: "Ley de Dalton", difficulty: "Easy",
                problem: "Mezcla gases: $P_{O2}=0.2$ atm, $P_{N2}=0.8$ atm. Total?",
                steps: ["$P_{tot} = \\sum P_i$."],
                solution: "$$ 1 \\text{ atm} $$"
            },
            {
                id: "TER-017", category: "basics", topic: "Calidad Vapor", difficulty: "Easy",
                problem: "1kg masa total, 0.8kg vapor, 0.2kg l√≠quido. Calidad $x$?",
                steps: ["$x = m_v / m_{tot}$.", "0.8/1.0."],
                solution: "$$ 0.8 $$"
            },
            {
                id: "TER-018", category: "basics", topic: "Capacidad Calor√≠fica", difficulty: "Easy",
                problem: "Calor para subir 1kg Al ($c=900$) en 10K.",
                steps: ["$1(900)(10)$."],
                solution: "$$ 9 \\text{ kJ} $$"
            },
            {
                id: "TER-019", category: "basics", topic: "Punto Triple Agua", difficulty: "Easy",
                problem: "¬øTemperatura del punto triple del agua?",
                steps: ["Definici√≥n SI."],
                solution: "$$ 273.16 \\text{ K} $$"
            },

            // ==========================================
            // 2. 1ER PRINCIPIO (FIRST LAW)
            // ==========================================
            {
                id: "TER-003", category: "first_law", topic: "Trabajo Isob√°rico", difficulty: "Easy",
                problem: "Un gas se expande a presi√≥n constante de 200 kPa desde $0.1 \\text{m}^3$ a $0.3 \\text{m}^3$. Calcule el trabajo $W$.",
                steps: ["$W = P\\Delta V$.", "$200000(0.3 - 0.1) = 200000(0.2)$."],
                solution: "$$ 40 \\text{ kJ} $$"
            },
            {
                id: "TER-004", category: "first_law", topic: "Primera Ley (Cerrado)", difficulty: "Medium",
                problem: "Un sistema recibe 500 J de calor y realiza 200 J de trabajo. Calcule $\\Delta U$.",
                steps: ["$\\Delta U = Q - W$.", "$\\Delta U = 500 - 200$."],
                solution: "$$ 300 \\text{ J} $$"
            },
            {
                id: "TER-012", category: "first_law", topic: "Relaci√≥n Adiab√°tica", difficulty: "Medium",
                problem: "Gas ideal monoat√≥mico ($\\gamma=1.67$). Compresi√≥n adiab√°tica $V_1=2, V_2=1$. $T_1=300$K. $T_2$?",
                steps: ["$T_1 V_1^{\\gamma-1} = T_2 V_2^{\\gamma-1}$.", "$300(2)^{0.67} = T_2$."],
                solution: "$$ 477 \\text{ K} $$"
            },
            {
                id: "TER-020", category: "first_law", topic: "Trabajo Ciclo", difficulty: "Medium",
                problem: "Ciclo horario en diagrama PV. √Årea encerrada 50J. Calor neto?",
                steps: ["$\Delta U_{ciclo}=0$. $Q_{net} = W_{net}$."],
                solution: "$$ 50 \\text{ J} $$"
            },
            {
                id: "TER-022", category: "first_law", topic: "Trabajo Adiab√°tico Irreversible", difficulty: "Hard",
                problem: "Gas ideal expande adiab√°ticamente contra $P_{ext}=1$ bar cte, desde 10 bar/300K hasta $P=1$ bar. $C_v=1.5R$. Calcule $T_f$.",
                steps: ["$Q=0, \\Delta U = W$. $nC_v(T_2-T_1) = -P_{ext}(V_2-V_1)$.", "$V = nRT/P$.", "$1.5R(T_2-300) = -1(RT_2/1 - RT_1/10)$."],
                solution: "$$ 192 \\text{ K} $$"
            },
            {
                id: "TER-037", category: "first_law", topic: "Turbina con Rendimiento", difficulty: "Hard",
                problem: "Vapor entra 6MPa/600C ($h=3658, s=7.16$). Sale 10kPa. $\\eta_T=85\\%$. $h_{2s}=2130$. Trabajo real?",
                steps: ["$w_s = 3658 - 2130 = 1528$.", "$w_a = 0.85(1528)$."],
                solution: "$$ 1299 \\text{ kJ/kg} $$"
            },
            {
                id: "TER-039", category: "first_law", topic: "Tobera Supers√≥nica", difficulty: "Hard",
                problem: "Aire entra 5bar/500K, sale 1bar. Velocidad max salida (sin fricci√≥n)? $c_p=1005$.",
                steps: ["Balance energ√≠a: $\\Delta h + v^2/2 = 0$.", "$T_2 = T_1(1/5)^{0.286} = 315K$.", "$v = \\sqrt{2(1005)(500-315)}$."],
                solution: "$$ 610 \\text{ m/s} $$"
            },

            // ==========================================
            // 3. 2DO PRINCIPIO Y ENTROP√çA (SECOND LAW)
            // ==========================================
            {
                id: "TER-008", category: "second_law", topic: "Eficiencia Carnot", difficulty: "Medium",
                problem: "M√°quina t√©rmica entre 600K y 300K. $\\eta$?",
                steps: ["$\\eta = 1 - T_L/T_H$.", "$1 - 300/600 = 0.5$."],
                solution: "$$ 50\\% $$"
            },
            {
                id: "TER-009", category: "second_law", topic: "COP Refrigerador", difficulty: "Medium",
                problem: "Refrigerador extrae 1000 J y consume 200 J trabajo. COP?",
                steps: ["$COP = Q_L / W$.", "$1000 / 200$."],
                solution: "$$ 5 $$"
            },
            {
                id: "TER-010", category: "second_law", topic: "Cambio Entrop√≠a Isot√©rmico", difficulty: "Medium",
                problem: "Gas absorbe 500J calor a 250K constante. $\\Delta S$?",
                steps: ["$\\Delta S = Q/T$.", "$500 / 250$."],
                solution: "$$ 2 \\text{ J/K} $$"
            },
            {
                id: "TER-023", category: "second_law", topic: "Entrop√≠a Mezcla Gases", difficulty: "Hard",
                problem: "Mezcla adiab√°tica de 1 mol $N_2$ y 1 mol $O_2$ a misma T y P. Calcule $\\Delta S_{gen}$.",
                steps: ["$\\Delta S = -nR \\sum x_i \\ln x_i$.", "$x=0.5$.", "$-2(8.314)(0.5 \\ln 0.5 + 0.5 \\ln 0.5)$."],
                solution: "$$ 11.5 \\text{ J/K} $$"
            },
            {
                id: "TER-025", category: "second_law", topic: "Exerg√≠a (Disponibilidad)", difficulty: "Hard",
                problem: "1kg agua a 373K se enfr√≠a a 300K (ambiente). Exerg√≠a destruida? $c=4.18$.",
                steps: ["$\\Delta S_{sys} = mc \\ln(300/373)$. $\\Delta S_{surr} = Q/300$.", "$Q = mc(73)$.", "Exerg√≠a perdida $I = T_0 \\Delta S_{univ}$."],
                solution: "$$ 19.5 \\text{ kJ} $$"
            },
            {
                id: "TER-030", category: "second_law", topic: "Entrop√≠a Gas Ideal Variable", difficulty: "Hard",
                problem: "Calcule $\\Delta S$ aire 300K a 1000K, $P=cte$, usando tablas ($s^0$). $s^0(1000)=2.968, s^0(300)=1.702$ kJ/kgK.",
                steps: ["$\\Delta S = s^0_2 - s^0_1 - R \\ln(P_2/P_1)$.", "Isobarico $\\ln(1)=0$.", "$2.968 - 1.702$."],
                solution: "$$ 1.266 \\text{ kJ/kgK} $$"
            },
            {
                id: "TER-031", category: "second_law", topic: "Compresor Iso vs Adiab√°tico", difficulty: "Hard",
                problem: "Ahorro trabajo al comprimir aire 100 a 1000 kPa isot√©rmicamente vs adiab√°tico ($\\gamma=1.4$).",
                steps: ["$W_{iso} = RT \\ln(10)$.", "$W_{adia} = \\frac{RT}{\\gamma-1} (10^{\\frac{\\gamma-1}{\\gamma}} - 1)$.", "Comparar factores."],
                solution: "$$ \\approx 28\\% \\text{ ahorro} $$"
            },
            {
                id: "TER-038", category: "second_law", topic: "Generaci√≥n Entrop√≠a Muro", difficulty: "Hard",
                problem: "Muro 1000W flujo. $T_1=500K, T_2=300K$. $\\dot{S}_{gen}$?",
                steps: ["Balance entrop√≠a volumen control muro.", "$\\dot{S}_{gen} = \\sum \\dot{Q}/T_{out} - \\sum \\dot{Q}/T_{in}$? No.", "$\\dot{Q}/T_{low} - \\dot{Q}/T_{high}$.", "$1000/300 - 1000/500 = 3.33 - 2$."],
                solution: "$$ 1.33 \\text{ W/K} $$"
            },

            // ==========================================
            // 4. CICLOS Y M√ÅQUINAS (CYCLES)
            // ==========================================
            {
                id: "TER-024", category: "cycles", topic: "Ciclo Diesel (Rendimiento)", difficulty: "Hard",
                problem: "Relaci√≥n compresi√≥n $r=16$, relaci√≥n corte $r_c=2$. $\\gamma=1.4$. $\\eta$?",
                steps: ["$\\eta = 1 - \\frac{1}{r^{\\gamma-1}} [\\frac{r_c^\\gamma-1}{\\gamma(r_c-1)}]$.", "$1 - \\frac{1}{3.03} [\\frac{1.63}{0.4(1)}]$.", "$1 - 0.33(4.07)$? No, revisar terminos.", "$1 - 0.329 (1.64/1.4) = 1 - 0.329(1.17) = 0.61$."],
                solution: "$$ 61.4\\% $$"
            },
            {
                id: "TER-028", category: "cycles", topic: "Ciclo Otto (MEP)", difficulty: "Hard",
                problem: "Otto ideal, $r=8$. $P_1=100, T_1=300$. $q_{in}=1800$ kJ/kg. Presi√≥n Media Efectiva?",
                steps: ["$\\eta = 1 - 1/8^{0.4} = 0.56$.", "$w_{net} = 0.56(1800) = 1008$.", "$v_1 = RT/P = 0.86$. $v_2 = v_1/8 = 0.107$.", "$MEP = w_{net}/(v_1-v_2)$."],
                solution: "$$ 1.34 \\text{ MPa} $$"
            },

            // ==========================================
            // 5. AVANZADO Y RELACIONES (ADVANCED)
            // ==========================================
            {
                id: "TER-007", category: "advanced", topic: "Conducci√≥n Fourier", difficulty: "Medium",
                problem: "Muro 20cm, $k=1.5$ W/mK, √Årea 10m2. $\\Delta T=20$K. Flujo calor?",
                steps: ["$\\dot{Q} = kA \\Delta T / L$.", "$1.5(10)(20) / 0.2 = 300/0.2$."],
                solution: "$$ 1500 \\text{ W} $$"
            },
            {
                id: "TER-015", category: "advanced", topic: "Tasa Radiaci√≥n", difficulty: "Medium",
                problem: "Cuerpo negro, $T=1000$K, $A=2$ m2. $\\sigma=5.67\\times 10^{-8}$.",
                steps: ["$P = \\sigma A T^4$.", "$5.67\\times 10^{-8}(2)(10^{12}) = 113400$."],
                solution: "$$ 113.4 \\text{ kW} $$"
            },
            {
                id: "TER-021", category: "advanced", topic: "Van der Waals (Presi√≥n)", difficulty: "Hard",
                problem: "Calcule P para 1 mol de $CO_2$ a 300K en 0.5L usando VdW. $a=3.59, b=0.0427$ (unidades atm). $R=0.082$.",
                steps: ["$P = RT/(V-b) - a/V^2$.", "$V=0.5$.", "$0.082(300)/(0.5-0.0427) - 3.59/0.25$.", "$53.79 - 14.36$."],
                solution: "$$ 39.4 \\text{ atm} $$"
            },
            {
                id: "TER-026", category: "advanced", topic: "Relaciones de Maxwell", difficulty: "Hard",
                problem: "Demuestre $(\\partial S/\\partial P)_T = -(\\partial V/\\partial T)_P$ usando $dG = VdP - SdT$.",
                steps: ["$G$ es funci√≥n estado exacta.", "$(\\partial V/\\partial T)_P = \\partial^2G/\\partial P \\partial T$.", "$-(\\partial S/\\partial P)_T = \\partial^2G/\\partial T \\partial P$.", "Igualar cruzadas."],
                solution: "$$ \\text{Q.E.D.} $$"
            },
            {
                id: "TER-027", category: "advanced", topic: "Conducci√≥n Transitoria (Lumped)", difficulty: "Hard",
                problem: "Esfera cobre 1cm ($Bi < 0.1$). Enfr√≠a de 100C a 50C en aire $h=100$. $c=385, \\rho=8960$. Tiempo?",
                steps: ["$\\frac{T-T_\\infty}{T_i-T_\\infty} = e^{-bt}$.", "$b = hA/\\rho V c = 3h/\\rho R c$.", "$b = 300 / (8960 \\cdot 0.005 \\cdot 385) = 0.0174$.", "$\\ln(25/75) = -0.0174 t$."],
                solution: "$$ 63 \\text{ s} $$"
            },
            {
                id: "TER-029", category: "advanced", topic: "Ecuaci√≥n Clapeyron", difficulty: "Hard",
                problem: "Estime cambio $T_{fus}$ hielo al subir P en 100 atm. $\\Delta v = -9 \\times 10^{-5}$ m3/kg, $L=334$ kJ/kg.",
                steps: ["$dT/dP = T \\Delta v / L$.", "$273 (-9\\times 10^{-5}) / 334000 = -7.3 \\times 10^{-8}$ K/Pa.", "$\\Delta T = -7.3 \\times 10^{-8} \\times 10^7$ Pa."],
                solution: "$$ -0.73 \\text{ K} $$"
            },
            {
                id: "TER-032", category: "advanced", topic: "Factor Compresibilidad Z", difficulty: "Hard",
                problem: "Gas a $P_r=2, T_r=1.5$. De gr√°fica Nelson-Obert $Z=0.8$. Volumen real vs ideal?",
                steps: ["$V_{real} = Z V_{ideal}$."],
                solution: "$$ 80\\% \\text{ del ideal} $$"
            },
            {
                id: "TER-033", category: "advanced", topic: "Intercambiador Calor (LMTD)", difficulty: "Hard",
                problem: "Contracorriente. Caliente 100->60. Fr√≠o 20->50. LMTD?",
                steps: ["$\\Delta T_1 = 100-50=50$. $\\Delta T_2 = 60-20=40$.", "$LMTD = (50-40)/\\ln(50/40)$."],
                solution: "$$ 44.8 \\text{ K} $$"
            },
            {
                id: "TER-034", category: "advanced", topic: "Coeficiente Joule-Thomson", difficulty: "Hard",
                problem: "Significado f√≠sico de $\\mu_{JT} = (\\partial T/\\partial P)_H = 0$ para gas ideal.",
                steps: ["Para ideal $H$ solo depende de $T$.", "En estrangulamiento $H=cte$.", "Si $H(T)=cte$, $T$ no cambia."],
                solution: "$$ \\text{No cambia T} $$"
            },
            {
                id: "TER-035", category: "advanced", topic: "Psicrometr√≠a", difficulty: "Hard",
                problem: "Aire 30¬∞C, $\\phi=60\\%$. $P_{sat}=4.24$ kPa. Presi√≥n vapor $P_v$ y humedad absoluta $\\omega$?",
                steps: ["$P_v = 0.6(4.24) = 2.54$.", "$\\omega = 0.622 P_v / (P_{tot}-P_v)$.", "$0.622(2.54)/(101-2.54)$."],
                solution: "$$ 0.016 \\text{ kg/kg} $$"
            },
            {
                id: "TER-036", category: "advanced", topic: "Energ√≠a Libre Gibbs", difficulty: "Hard",
                problem: "Reacci√≥n $A \\to B$. $\\Delta H = -10$ kJ, $\\Delta S = -20$ J/K. ¬øT de equilibrio?",
                steps: ["$\\Delta G = \\Delta H - T \\Delta S = 0$.", "$T = \\Delta H / \\Delta S$.", "$-10000 / -20$."],
                solution: "$$ 500 \\text{ K} $$"
            },
            {
                id: "TER-040", category: "advanced", topic: "Fugacidad", difficulty: "Hard",
                problem: "Concepto: Para gas ideal $f = P$. Para real $f = \\phi P$. Si $Z=0.9$ constante, estime $\\ln \\phi$.",
                steps: ["$\\ln \\phi = \\int_0^P (Z-1)/P dP$.", "$(0.9-1) \\ln P$? No, integral de $(Z-1) dP/P$."],
                solution: "$$ -0.1 \\ln P $$"
            }
        ];

        const filters = [
            { id: 'all', label: 'Todo', icon: 'üìö' },
            { id: 'basics', label: 'Fundamentos', icon: 'üå°Ô∏è' },
            { id: 'first_law', label: '1er Principio', icon: 'üîã' },
            { id: 'second_law', label: '2do Principio', icon: 'üåÄ' },
            { id: 'cycles', label: 'Ciclos', icon: '‚öôÔ∏è' },
            { id: 'advanced', label: 'Avanzado', icon: 'üß†' },
        ];

        // --- STATE ---
        let currentFilter = 'all';
        let theme = 'light';

        // --- DOM ELEMENTS ---
        const navContainer = document.getElementById('nav-container');
        const mobileFilters = document.getElementById('mobile-filters');
        const gridContainer = document.getElementById('exercise-grid');
        const themeBtn = document.getElementById('theme-toggle');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContent = document.getElementById('modal-content');

        // --- INITIALIZATION ---
        function init() {
            renderNavigation();
            renderGrid();
            updateProgress();
            
            // Check local storage for theme preference
            if (localStorage.getItem('theme') === 'dark') {
                toggleTheme();
            }
        }

        // --- RENDER FUNCTIONS ---
        function renderNavigation() {
            // Desktop Sidebar
            navContainer.innerHTML = filters.map(f => `
                <button 
                    onclick="setFilter('${f.id}')"
                    class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-200 group w-full text-left
                    ${currentFilter === f.id 
                        ? 'bg-brand-50 text-brand-600 dark:bg-brand-500/10 dark:text-brand-500' 
                        : 'text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white'}"
                >
                    <span class="text-lg opacity-80 group-hover:opacity-100 group-hover:scale-110 transition-transform">${f.icon}</span>
                    <span class="hidden lg:block">${f.label}</span>
                </button>
            `).join('');

            // Mobile Filters
            mobileFilters.innerHTML = filters.map(f => `
                <button
                    onclick="setFilter('${f.id}')"
                    class="px-4 py-2 rounded-full border text-sm font-medium whitespace-nowrap transition-all
                    ${currentFilter === f.id
                        ? 'bg-brand-600 border-brand-600 text-white shadow-lg shadow-brand-500/20'
                        : 'bg-white dark:bg-dark-card border-slate-200 dark:border-dark-border text-slate-500 dark:text-slate-400'}"
                >
                    ${f.label}
                </button>
            `).join('');
        }

        function renderGrid() {
            const filtered = currentFilter === 'all' 
                ? exercises 
                : exercises.filter(ex => ex.category === currentFilter);

            gridContainer.innerHTML = filtered.map((ex, idx) => {
                const diffColor = getDifficultyColor(ex.difficulty);
                return `
                <article 
                    onclick="openModal('${ex.id}')"
                    class="group bg-white dark:bg-dark-card border border-slate-200 dark:border-dark-border rounded-2xl p-6 flex flex-col cursor-pointer hover:-translate-y-1 hover:shadow-xl hover:border-slate-300 dark:hover:border-white/20 transition-all duration-300 animate-fadeInUp"
                    style="animation-delay: ${idx * 0.02}s"
                >
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex gap-2 flex-wrap">
                            <span class="px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider ${diffColor}">
                                ${ex.difficulty}
                            </span>
                            <span class="px-2.5 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider bg-slate-100 text-slate-500 dark:bg-white/5 dark:text-slate-400 border border-slate-200 dark:border-white/10">
                                ${ex.category.toUpperCase().slice(0,5)}
                            </span>
                        </div>
                        <span class="font-mono text-xs text-slate-400">${ex.id}</span>
                    </div>

                    <div class="flex-1 mb-6">
                        <h3 class="font-display font-bold text-lg mb-2 text-slate-800 dark:text-slate-100">${ex.topic}</h3>
                        <div class="text-sm text-slate-600 dark:text-slate-400 line-clamp-3 leading-relaxed">
                            ${ex.problem}
                        </div>
                    </div>

                    <div class="pt-4 border-t border-slate-100 dark:border-white/5 flex justify-between items-center text-brand-600 dark:text-brand-400 font-semibold text-sm">
                        <span>Ver Soluci√≥n</span>
                        <span class="group-hover:translate-x-1 transition-transform">‚Üí</span>
                    </div>
                </article>
                `;
            }).join('');

            refreshMath();
        }

        function getDifficultyColor(diff) {
            switch (diff) {
                case 'Easy': return 'bg-emerald-100 text-emerald-700 dark:bg-emerald-500/10 dark:text-emerald-400';
                case 'Medium': return 'bg-amber-100 text-amber-700 dark:bg-amber-500/10 dark:text-amber-400';
                case 'Hard': return 'bg-rose-100 text-rose-700 dark:bg-rose-500/10 dark:text-rose-400';
                default: return 'bg-gray-100 text-gray-700';
            }
        }

        function updateProgress() {
            document.getElementById('progress-text').innerText = `0/${exercises.length}`;
        }

        // --- INTERACTION ---
        function setFilter(id) {
            currentFilter = id;
            renderNavigation();
            renderGrid();
        }

        // --- MODAL ---
        function openModal(id) {
            const ex = exercises.find(e => e.id === id);
            if(!ex) return;

            document.getElementById('modal-title').innerText = ex.topic;
            document.getElementById('modal-id').innerText = `ID: ${ex.id}`;
            document.getElementById('modal-problem').innerHTML = ex.problem;
            document.getElementById('modal-solution').innerHTML = ex.solution;

            const stepsContainer = document.getElementById('modal-steps');
            stepsContainer.innerHTML = ex.steps.map((step, i) => `
                <div class="p-5 bg-slate-50 dark:bg-white/5 rounded-xl border-l-4 border-brand-500 animate-slideInRight" style="animation-delay: ${i * 0.1}s">
                    <span class="text-xs font-mono text-slate-400 dark:text-slate-500 mb-2 block">PASO ${i + 1}</span>
                    <div class="text-slate-700 dark:text-slate-300">
                        ${step}
                    </div>
                </div>
            `).join('');

            modalBackdrop.classList.remove('opacity-0', 'invisible', 'pointer-events-none');
            modalContent.classList.remove('scale-95', 'translate-y-10');
            modalContent.classList.add('scale-100', 'translate-y-0');

            refreshMath();
        }

        function closeModal() {
            modalBackdrop.classList.add('opacity-0', 'invisible', 'pointer-events-none');
            modalContent.classList.remove('scale-100', 'translate-y-0');
            modalContent.classList.add('scale-95', 'translate-y-10');
        }

        // Close modal on backdrop click
        modalBackdrop.addEventListener('click', (e) => {
            if(e.target === modalBackdrop) closeModal();
        });

        // --- THEME ---
        themeBtn.addEventListener('click', toggleTheme);

        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                themeBtn.innerText = '‚òÄÔ∏è';
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                themeBtn.innerText = 'üåô';
            }
        }

        // --- MATHJAX ---
        function refreshMath() {
            if (window.MathJax && window.MathJax.typesetPromise) {
                setTimeout(() => {
                     window.MathJax.typesetPromise();
                }, 10);
            }
        }

        // Run
        init();

    </script>
</body>
</html>
